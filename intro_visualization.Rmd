---
title: "Visualizing Data"
subtitle: "An introduction to ggplot2"  
author: "CSC 442/ST 442"
date: 'Fall 2019'
output:
  xaringan::moon_reader:
    lib_dir: libs
    css: xaringan-themer.css
    nature:
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
    df_print: tibble
---

```{r setup, include=FALSE}
options(htmltools.dir.version = FALSE)
```

```{r xaringan-themer, include = FALSE}
library(xaringanthemer)
# duo_accent(primary_color = "#006747", secondary_color = "#CFC493",
#   title_slide_background_color = "#FFFFFF",
#   title_slide_text_color = "#006747",
#   header_font_google = google_font("Josefin Sans"),
#   title_slide_background_image = "ncstate.png",
#   title_slide_background_size = "600px",
#   title_slide_background_position = "bottom",
#   text_font_google   = google_font("Montserrat", "300", "300i"),
#   code_font_family = "Fira Code",
#   code_font_url = "https://cdn.rawgit.com/tonsky/FiraCode/1.204/distr/fira_code.css"
# )
duo(primary_color = "#1F4257", secondary_color = "#F97B64",
  text_font_google   = google_font("Montserrat", "300", "300i"),
  code_font_family = "Fira Code",
  code_font_url = "https://cdn.rawgit.com/tonsky/FiraCode/1.204/distr/fira_code.css"
)
```

#ggplot2
We introduce the **ggplot2** package which provides a unifying framework and, correspondingly, a grammar for describing and specifying graphics. The use of a grammar allows for a coherent system for describing and building graphics using a number of simple and well-defined commands. A comprehensive description of **ggplot2** is available from [ggplot2: Elegant graphics for data analysis](https://catalog.lib.ncsu.edu/catalog/NCSU3716602) and [R Graphics Cookbook](https://r-graphics.org). 
---
As an example, the following figure was generated using data from the average daily temperature archive at the [University of Daytona](http://academic.udayton.edu/kissock/http/Weather/).

```{r echo = FALSE, cache = TRUE, warning = FALSE, message = FALSE, fig.retina = 4, fig.align = 'center', out.width="120%", fig.asp = 0.6}
source("daytona.R")
p <- daytona_plot()
print(p)
```
---
As another example, consider the following famous plot of Charles Minard on Napoleon's 1812 winter retreat from Moscow. During this excursion, the Grande Armee dropped from $422000$ to $10000$ troops.

```{r echo = FALSE}
knitr::include_graphics("https://www.andrewheiss.com/files/images/minard/Minard.png")
```
---
A **R** version generated by **ggplot2** code is below.

```{r, echo = FALSE, cache = TRUE, warning = FALSE, message = FALSE, fig.retina = 4, out.width = "120%", fig.asp = 0.5}
source("napoleon_fig/napoleon_fig.R")
p <- napoleon_plot()
grid::grid.newpage()
grid::grid.draw(p)
```
Close, but no cigar ? In any case, the above plot is nice in that a total of six variables are mapped to six *aesthetics*; $x$ and $y$ axis mapped to the location of the army, the size of the army is mapped to the size of the line, the direction of movement is mapped to color, date of points along retreat path is mapped to the text below plot, and the temperature during the retreat is mapped to the line below the plot.
---
##ggplot2 grammar
We start with a very simple plot. Consider the following dataset about fuel efficieny for cars.

```{r echo = -2, fig.align = 'center', out.width = "50%"}
library(ggplot2)
theme_set(theme_bw())
data(mpg)
select(mpg, -fl, -class)
```
---
We now plot a scatterplot of the relationship between engine size vs
mile per gallon for highway driving.

```{r, fig.align = 'center', out.width = "100%", fig.asp = 0.6, fig.retina = 3}
p <- ggplot(data = mpg) + 
  geom_point(mapping = aes(x = displ, y = hwy)) + 
  xlab("Engine Size") + ylab("Highway mile per gallon")
p
```
---
We next color the cars based on its class (e.g., compact vs suv vs pickup)
```{r fig.align = 'center', out.width = "100%", fig.asp = 0.6, fig.retina = 3}
p <- ggplot(data = mpg) + 
  geom_point(mapping = aes(x = displ, y = hwy, color = class)) + 
  xlab("Engine Size") + ylab("Highway mile per gallon")
p
```
---
Compare the previous plot with the following two plots.
```{r fig.align = 'center', fig.asp = 0.4, fig.retina = 3, out.width = "120%", warning = FALSE}
p1 <- ggplot(data = mpg) + 
  geom_point(mapping = aes(x = displ, y = hwy, size = class))
p2 <- ggplot(data = mpg) + 
  geom_point(mapping = aes(x = displ, y = hwy, alpha = class))
require(gridExtra)
grid.arrange(p1,p2,ncol = 2)
```
---
We see that the plots differ in which aesthetic the variable *class* is mapped to, e.g., color vs size vs alpha translucency.