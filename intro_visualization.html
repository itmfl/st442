<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
  <head>
    <title>Visualizing Data</title>
    <meta charset="utf-8" />
    <meta name="author" content="CSC/ST 442" />
    <link href="libs/remark-css/default.css" rel="stylesheet" />
    <link href="libs/remark-css/metropolis.css" rel="stylesheet" />
    <link href="libs/remark-css/metropolis-fonts.css" rel="stylesheet" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# Visualizing Data
## An introduction to ggplot2
### CSC/ST 442
### Fall 2019

---





#ggplot2
We introduce the **ggplot2** package which provides a unifying framework and, correspondingly, a grammar for describing and specifying graphics. The use of a grammar allows for a coherent system for describing and building graphics using a number of simple and well-defined commands. 

Some useful online resources on on **ggplot2** are
+ A comprehensive description of **ggplot2** is available from [ggplot2: Elegant graphics for data analysis](https://catalog.lib.ncsu.edu/catalog/NCSU3716602)

+ Detailed examples are given in [R Graphics Cookbook](https://r-graphics.org). 

+ A neat cheat sheet is the [R Studio ggplot2 cheatsheet](https://www.rstudio.com/wp-content/uploads/2015/03/ggplot2-cheatsheet.pdf)
---
class: clear

As an example, the following figure was generated using data from the average daily temperature archive at the [University of Daytona](http://academic.udayton.edu/kissock/http/Weather/).

&lt;img src="intro_visualization_files/figure-html/unnamed-chunk-1-1.png" width="120%" style="display: block; margin: auto;" /&gt;
---
class: clear
As another example, consider the following famous plot of Charles Minard on Napoleon's 1812 winter retreat from Moscow. During this excursion, the Grande Armee dropped from `\(422000\)` to `\(10000\)` troops.

&lt;img src="https://www.andrewheiss.com/files/images/minard/Minard.png" width="120%" style="display: block; margin: auto;" /&gt;
---
class: clear
A **R** version generated by **ggplot2** code is below.

&lt;img src="intro_visualization_files/figure-html/unnamed-chunk-3-1.png" width="120%" style="display: block; margin: auto;" /&gt;

Close, but no cigar ? In any case, the above plot is nice in that a total of six variables are mapped to six *aesthetics*; `\(x\)` and `\(y\)` axis mapped to the location of the army, the size of the army is mapped to the size of the line, the direction of movement is mapped to color, date of points along retreat path is mapped to the text below plot, and the temperature during the retreat is mapped to the line below the plot.
---
#ggplot2 basic
We start with a very simple plot. Consider the following dataset about fuel efficieny for cars.


```r
library(ggplot2)
data(mpg)
select(mpg, -fl, -class)
```

```
## # A tibble: 234 x 9
##   manufacturer model displ  year   cyl trans      drv     cty   hwy
##   &lt;chr&gt;        &lt;chr&gt; &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt;      &lt;chr&gt; &lt;int&gt; &lt;int&gt;
## 1 audi         a4      1.8  1999     4 auto(l5)   f        18    29
## 2 audi         a4      1.8  1999     4 manual(m5) f        21    29
## 3 audi         a4      2    2008     4 manual(m6) f        20    31
## 4 audi         a4      2    2008     4 auto(av)   f        21    30
## 5 audi         a4      2.8  1999     6 auto(l5)   f        16    26
## 6 audi         a4      2.8  1999     6 manual(m5) f        18    26
## # â€¦ with 228 more rows
```
---
class: clear
We now plot a scatterplot of the relationship between engine size vs
mile per gallon for highway driving.


```r
p &lt;- ggplot(data = mpg) + 
  geom_point(mapping = aes(x = displ, y = hwy)) + 
  xlab("Engine Size") + ylab("Highway mile per gallon")
p
```

&lt;img src="intro_visualization_files/figure-html/unnamed-chunk-5-1.png" width="80%" style="display: block; margin: auto;" /&gt;
---
class: clear
We next color the cars based on its class (e.g., compact vs suv vs pickup)

```r
p &lt;- ggplot(data = mpg) + 
  geom_point(mapping = aes(x = displ, y = hwy, color = class)) + 
  xlab("Engine Size") + ylab("Highway mile per gallon")
p
```

&lt;img src="intro_visualization_files/figure-html/unnamed-chunk-6-1.png" width="80%" style="display: block; margin: auto;" /&gt;
---
class: clear
Compare the previous plot with the following two plots.

```r
p1 &lt;- ggplot(data = mpg) + 
  geom_point(mapping = aes(x = displ, y = hwy, size = class))
p2 &lt;- ggplot(data = mpg) + 
  geom_point(mapping = aes(x = displ, y = hwy, alpha = class))
require(gridExtra)
grid.arrange(p1,p2,ncol = 2)
```

&lt;img src="intro_visualization_files/figure-html/unnamed-chunk-7-1.png" width="120%" style="display: block; margin: auto;" /&gt;
---
#aes()
We see that the plots differ in which aesthetic the variable *class* is mapped to, e.g., color vs size vs alpha translucency.

A variable can be mapped to a number of different aesthetics; the choice of aesthetics also depend on the *geom\_function* that is used. For example, `\(\mathrm{geom\_point}\)` understands the following aesthetics
+ `\(x\)` and `\(y\)` for coordinates (required)
+ `\(\mathrm{alpha}\)`, `\(\mathrm{color}\)`, `\(\mathrm{fill}\)` for color and shade.
+ `\(\mathrm{size}\)`, `\(\mathrm{shape}\)` and `\(\mathrm{stroke}\)`.
+ `\(\mathrm{group}\)` (not used?)

In contrasts, `\(\mathrm{geom\_line}\)` understands the following aesthetics
+ `\(x\)` and `\(y\)` (required)
+ `\(\mathrm{alpha}\)` and `\(\mathrm{color}\)`
+ `\(\mathrm{linetype}\)` and `\(\mathrm{size}\)`
+ `\(\mathrm{group}\)` (use to draw multiple lines, one for each group)
---
class: clear
We can also set an aesthetic manually, i.e., does not map it to a variable, by setting the aesthetic to a constant outside of the `\(\mathrm{aes()}\)` call, e.g.,

```r
ggplot(mpg) + 
  geom_point(aes(x = displ, y = hwy), color = "blue", shape = 24)
```

&lt;img src="intro_visualization_files/figure-html/unnamed-chunk-8-1.png" width="80%" style="display: block; margin: auto;" /&gt;
---
#facet
We can also introduce additional (categorical) variables through the use of faceting, i.e., split your data into groups and display different subplots (but using the same *geom_functions*) for each subgroups. 

```r
ggplot(data = mpg) + 
  geom_point(mapping = aes(x = displ, y = hwy, col = cyl)) +
  facet_wrap(~ class, nrow = 2)
```

&lt;img src="intro_visualization_files/figure-html/unnamed-chunk-9-1.png" width="70%" style="display: block; margin: auto;" /&gt;
---
class: clear
We can also facet our plots using a combination of two (categorical) variables, e.g.,

```r
ggplot(data = mpg) + 
  geom_point(mapping = aes(x = displ, y = hwy, col = cyl)) +
  facet_grid(drv ~ cyl)
```

&lt;img src="intro_visualization_files/figure-html/unnamed-chunk-10-1.png" width="80%" style="display: block; margin: auto;" /&gt;
---
#Geometric objects
Consider the following three plots. Each plot uses the same `\(x\)` and `\(y\)` coordinates, but different *geoms* or geometric objects.

```r
p &lt;- ggplot(data = mpg, mapping = aes(x = displ, y = hwy))
p1 &lt;- p + geom_point() + ggtitle("Plot 1")
p2 &lt;- p + geom_smooth() + ggtitle("Plot 2")
p3 &lt;- p + geom_point() + geom_smooth() + ggtitle("Plot 3")
grid.arrange(p1,p2,p3, ncol = 3)
```

&lt;img src="intro_visualization_files/figure-html/unnamed-chunk-11-1.png" width="100%" style="display: block; margin: auto;" /&gt;
---
class: clear
Compare also the following two plots.

```r
p &lt;- ggplot(data = mpg, mapping = aes(x = displ, y = hwy))
p1 &lt;- p + geom_point(aes(color = drv))
p2 &lt;- p + geom_smooth(aes(color = drv))
grid.arrange(p1,p2,ncol = 2)
```

&lt;img src="intro_visualization_files/figure-html/unnamed-chunk-12-1.png" width="120%" style="display: block; margin: auto;" /&gt;
---
class: clear
Finally, each geom object can also use different data set.

```r
ggplot(mpg, mapping = aes(x = displ, y = hwy)) +
  geom_point(aes(color = class), show.legend = FALSE) + 
  geom_smooth(data = filter(mpg, class == "subcompact"))
```

&lt;img src="intro_visualization_files/figure-html/unnamed-chunk-13-1.png" width="80%" style="display: block; margin: auto;" /&gt;
---
#Histograms and Bar Plots
We now present examples of two of the most elementary and widely used plots.

```r
library(mdsr) ## from the book Modern Data Science with R
data(SAT_2010)
p1 &lt;- ggplot(SAT_2010, aes(x = math)) + geom_histogram(binwidth=10)
p2 &lt;- ggplot(SAT_2010, aes(x = math)) + geom_density() + geom_rug()
grid.arrange(p1,p2,ncol = 2)
```

&lt;img src="intro_visualization_files/figure-html/unnamed-chunk-14-1.png" width="80%" style="display: block; margin: auto;" /&gt;
---
class: clear
Compare the following two plots. For more details, see the section for computed variables in `\(\mathrm{?geom\_histogram()}\)`.

```r
p1 &lt;- ggplot(SAT_2010, aes(x = math)) + geom_histogram(binwidth = 10)
p2 &lt;- ggplot(SAT_2010, aes(x = math)) + 
  geom_histogram(aes(y = ..density..),binwidth=10)
grid.arrange(p1,p2,ncol = 2)
```

&lt;img src="intro_visualization_files/figure-html/unnamed-chunk-15-1.png" width="80%" style="display: block; margin: auto;" /&gt;
---
class: clear
Compare the following two plots.

```r
p &lt;- ggplot(data = head(SAT_2010,10),
            aes(x = reorder(state, math))) + xlab("") + 
  theme(axis.text.x = element_text(angle = 90, hjust = 1))
p1 &lt;- p + geom_bar() 
p2 &lt;- p + geom_bar(aes(y = math), stat = "identity")
grid.arrange(p1,p2,ncol = 2)
```

&lt;img src="intro_visualization_files/figure-html/unnamed-chunk-16-1.png" width="120%" style="display: block; margin: auto;" /&gt;
---
# Example 1: US Gun Murders in 2010
We now present a few more sophisticated examples of **ggplot2** output. 

```r
## The package dslabs accompanies the book 
## Introduction to Data Science @ https://rafalab.github.io/dsbook/
library(dslabs)
data(murders)
```

&lt;table&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt; state &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; abb &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; region &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; population &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; total &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Alabama &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; AL &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; South &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 4779736 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 135 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Alaska &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; AK &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; West &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 710231 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 19 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Arizona &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; AZ &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; West &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 6392017 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 232 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Arkansas &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; AR &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; South &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 2915918 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 93 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; California &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; CA &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; West &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 37253956 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1257 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Colorado &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; CO &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; West &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 5029196 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 65 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
---
class: clear
We start with the most naive plot. This plot exhibits an undesirable property in that there are a few points that are far from the remaining points (states with large population and a lot of murders)

```r
p &lt;- ggplot(murders, aes(x = population/10^6, y = total)) + 
  geom_point()
p
```

&lt;img src="intro_visualization_files/figure-html/unnamed-chunk-18-1.png" width="80%" style="display: block; margin: auto;" /&gt;
---
class: clear
We remedy the above situation by plotting on a `\(\log\)` `\(\log\)` scale.

```r
p &lt;- p + scale_x_continuous(trans = "log10") +
         scale_y_continuous(trans = "log10")
p
```

&lt;img src="intro_visualization_files/figure-html/unnamed-chunk-19-1.png" width="80%" style="display: block; margin: auto;" /&gt;
---
class: clear
We now add text labels.

```r
p + geom_text(aes(label = abb))
```

&lt;img src="intro_visualization_files/figure-html/unnamed-chunk-20-1.png" width="80%" style="display: block; margin: auto;" /&gt;
---
class: clear
The previous output looks quite a bit ugly as the text is all jumbled up with the data points. We can adjust this by nudging the labels slightly.

```r
p + geom_text(aes(label = abb), nudge_x = 0.1)
```

&lt;img src="intro_visualization_files/figure-html/unnamed-chunk-21-1.png" width="80%" style="display: block; margin: auto;" /&gt;
---
class: clear
The output is not really improved. So we give up and call in the big guns.

```r
library(ggrepel)
p + geom_text_repel(aes(label = abb))
```

&lt;img src="intro_visualization_files/figure-html/unnamed-chunk-22-1.png" width="80%" style="display: block; margin: auto;" /&gt;
---
class: clear
A few more polishing touches yield the following output

&lt;img src="intro_visualization_files/figure-html/plot-label-1.png" width="80%" style="display: block; margin: auto;" /&gt;

---
class: clear
The code generating the previous plot is


```r
library(ggthemes)
p &lt;- ggplot(murders, aes(x = population/10^6, y = total)) +
  geom_point(aes(col = region), size = 3) + 
  geom_text_repel(aes(label = abb)) +
  scale_x_log10() + scale_y_log10() +
  xlab("Population in millions (log scale)") + 
  ylab("Murders (log scale)") + 
  ggtitle("US Gun Murders in 2010") + 
  scale_color_discrete(name = "Region") + 
  geom_smooth(method = "lm", se = FALSE) +
  theme_economist()
p
```
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "zenburn",
"highlightLines": true,
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();</script>

<script>
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
